<?xml version="1.0" encoding="UTF-8"?>
<project name="upload-war" default="upload-war" basedir="."
    xmlns:dav="antlib:org.apache.webdav.ant"
    xmlns:caroline="antlib:com.sun.caroline.tools.carolant">

  <!-- Where the war file is -->
  <condition property="war.dir" value="../../WebMusicExplaura/dist">
    <not>
      <isset property="war.dir"/>
    </not>
  </condition>
      
  <condition property="war.file" value="WebMusicExplaura.war">
    <not>
      <isset property="war.file"/>
    </not>
  </condition>
      

    <!-- Where the libraries are -->
    <property name="tool.libraries" value="../../ToolLibraries"/>

    <!-- Declare the Caroline tasks -->
    <taskdef resource="com/sun/caroline/tools/carolant/antlib.xml"
            uri="antlib:com.sun.caroline.tools.carolant">
        <classpath>
            <pathelement location="${tool.libraries}/carolant.jar"/>
            <pathelement location="${tool.libraries}/caroline.jar"/>
        </classpath>
    </taskdef>
        
   <!-- Declare the WebDAV tasks -->
    <taskdef resource="org/apache/webdav/ant/antlib.xml" uri="antlib:org.apache.webdav.ant">
        <classpath>
            <pathelement location="${tool.libraries}/jakarta-slide-ant-webdav-2.2pre1.jar"/>
            <pathelement location="${tool.libraries}/jakarta-slide-webdavlib-2.2pre1.jar"/>
            <pathelement location="${tool.libraries}/commons-httpclient.jar"/>
            <pathelement location="${tool.libraries}/commons-logging.jar"/>
            <pathelement location="${tool.libraries}/jdom-1.0.jar"/>
        </classpath>
    </taskdef>
    
    <loadproperties srcfile="${user.home}${file.separator}.caroline">
        <filterchain>
            <prefixlines prefix="grid."/>
        </filterchain>
    </loadproperties>

    <!-- create a grid adapter instance to retrieve a reference the grid -->
    <caroline:grid/>

    <!-- use implicit properties set by the grid adapter above-->    
    <property name="user" value="${com.sun.caroline.customerID}"/>
    <property name="pw" value="${com.sun.caroline.password}"/>
    <property name="dav.url" value="${com.sun.caroline.gridURL}/${user}"/>
    <property name="grid.url" value="${com.sun.caroline.gridURL}"/>   
    <property name="dist.filesystem" value="${grid.instance}-aura.dist"/>
    
    <!-- create a WebDAV collection to which we can upload war files -->
    <target name="create-war-collection" description="Creates war file directory">
        <dav:mkcol url="${dav.url}/${dist.filesystem}/war" 
		   userid="${user}" password="${pw}" verbose="true"/>
    </target>

    <!-- Upload the war file to the collection. -->
    <target name="upload-war" description="Uploads war file">
      <dav:put url="${dav.url}/${grid.instance}-aura.dist/war"
	       userid="${user}" password="${pw}" lock="false" verbose="true">
	<fileset dir="${war.dir}">
	  <include name="${war.file}"/>
	</fileset>
      </dav:put>
    </target>  
    
</project>