<?xml version="1.0" encoding="UTF-8"?>
<!-- You may freely edit this file. See commented blocks below for -->
<!-- some examples of how to customize the build. -->
<!-- (If you delete it and reopen the project it will be recreated.) -->
<project name="grid" default="default" basedir="."
    xmlns:dav="antlib:org.apache.webdav.ant"
    xmlns:caroline="antlib:com.sun.caroline.tools.carolant">
    <description>Builds and deploys grid projects.</description>
    <import file="nbproject/build-impl.xml"/>
    
    <!-- Load the grid properties if they're there, so that we can get the
        instance name -->
    <loadproperties srcfile="${user.home}${file.separator}.caroline">
        <filterchain>
            <prefixlines prefix="grid."/>
        </filterchain>
    </loadproperties>
    
    <property name="tool.libraries" value="../ToolLibraries"/>
    
    <!-- A webdav URL for all our filesystems. -->
    <property name="dav.url" value="${gridURL}/${customerID}/"/>
    
    <!-- A webdav URL for the dist filesystem. -->
    <property name="dist.url" value="${dav.url}/${instance}-aura.dist"/>
    
    <!-- A webdav collection for the ant packages -->
    <property name="ant.col" value="sys.packages/org/apache/tools/ant/1.7.0/lib/"/>
    
    <!-- Where the Ant libraries are -->
    <property name="ant.lib" value="${tool.libraries}/ant-lib"/>
   
    <!-- The name of the system packages file system -->
    <property name="packages.filesystem" value="sys.packages"/>   
     
    <!-- The name of the code filesystem on grid. -->
    <property name="code.filesystem" value="${instance}-aura.dist"/>
     
    <!-- Declare the Caroline tasks -->
    <taskdef resource="com/sun/caroline/tools/carolant/antlib.xml"
            uri="antlib:com.sun.caroline.tools.carolant">
        <classpath>
            <pathelement location="${tool.libraries}/carolant.jar"/>
            <pathelement location="${tool.libraries}/caroline.jar"/>
        </classpath>
    </taskdef>
        
   <!-- Declare the Caroline Ant tasks -->
    <taskdef resource="org/apache/webdav/ant/antlib.xml" uri="antlib:org.apache.webdav.ant">
        <classpath>
            <pathelement location="${tool.libraries}/jakarta-slide-ant-webdav-2.2pre1.jar"/>
            <pathelement location="${tool.libraries}/jakarta-slide-webdavlib-2.2pre1.jar"/>
            <pathelement location="${tool.libraries}/commons-httpclient.jar"/>
            <pathelement location="${tool.libraries}/commons-logging.jar"/>
        </classpath>
    </taskdef>
    
    <!-- create a grid adapter instance to retrieve a reference the grid -->
    <caroline:grid/>
    
    <!-- Creates the basic filesystems -->
    <target name="create-filesystems" 
        description="Creates necessary file systems">
        <caroline:filesystem name="${packages.filesystem}" op="create"/>
        <caroline:filesystem name="${code.filesystem}" op="create"/>
    </target>
    
    <!-- create a WebDAV collection to upload Ant jars to-->
    <target name="create-ant-collection" 
        description="creates Ant package"
        depends="create-filesystems">
        <dav:mkcol url="${dav.url}/${ant.col}" 
            userid="${customerID}" password="${password}"/>            
    </target>
    
    <!-- create a target to copy Ant jars to Caroline -->
    <target name="deploy-ant" description="copies Ant libraries" 
        depends="create-ant-collection">
        <dav:put url="${dav.url}/${ant.col}" 
            userid="${customerID}" password="${password}" lock="false">
            <fileset dir="${ant.lib}">
                <include name="*.jar"/>
            </fileset>        
        </dav:put>
    </target>  
    
    <!-- Copy this project's distribution jar to the Grid -->
    <target depends="jar" name="grid-copy">
        <dav:put url="${dist.url}"
          userid="${customerID}" password="${password}" overwrite="true">
            <fileset dir=".">
                <include name="dist/grid.jar"/>
            </fileset>
        </dav:put>
    </target>
    
    <!-- Copy the top level projects' distribution jars to the Grid -->
    <target name="grid-aardvark-copy">
        <dav:put url="${dist.url}"
          userid="${customerID}" password="${password}" overwrite="true">
            <fileset dir="../aardvark/dist">
                <filename name="aardvark-dist.jar"/>
            </fileset>
        </dav:put>
    </target>
</project>
