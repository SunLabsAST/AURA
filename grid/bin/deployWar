#!/bin/bash

if [ $1 == "-h" ] ; then
    echo 'deployWar [name] [num] [warfile]'
    exit;
fi;

DIR=`dirname $0`

NAME=$1
if [ -z $NAME] ; then
    NAME=www
fi

NUM=$2
if [ -z $NUM ] ; then
    NUM=5
fi

FILE=$3
if [ -z $FILE ] ; then
   FILE=$DIR/../../WebMusicExplaura/dist/WebMusicExplaura.war
fi
export FILE

WARDIR=`dirname $FILE`
WARFILE=`basename $FILE`

COUNT=1

export ANT_OPTS="-Xmx512m"

ant -Dwar.dir=$WARDIR -Dwar.file=$WARFILE -f $DIR/../grid-deploy/upload-war.xml 
for (( COUNT=1 ; COUNT <= $NUM ; COUNT++ )) ; do 
    echo Deploying $FILE to $NAME-$COUNT...
    ant -Ddeployment.name=$NAME \
    	-Ddeployment.number=$COUNT -Dwar.file=$WARFILE \
    	-f $DIR/../grid-deploy/deploy-war.xml 
done